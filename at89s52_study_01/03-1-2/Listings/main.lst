C51 COMPILER V9.60.0.0   MAIN                                                              03/20/2020 22:21:02 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2          *Project name: 4_digit 7-segment timer (with two timer interrupts)                                        
             -                                                                                                                        
             -                                                                                                  
   3          *File name: main.c
   4          *Author: Sean Kim
   5          *Date: 03.19.20
   6          *Edited: 
   7          */
   8          
   9          #include "main.h"
  10          #include "at89x52.h"
  11          
  12          
  13          bit T_int_flag_01 = 0;
  14          bit T_int_flag_02 = 0;
  15          
  16          
  17          unsigned char a=0, b=0, c=0, d=0;
  18          unsigned char i=0, j=0, k=0;
  19          unsigned char num[] = {0x40, 0x79, 0x24, 0x30, 0x19, 0x12, 0x02, 0x78, 0x00, 0x10}; 
  20                                    //7-segment? common cathod
  21                        
  22          unsigned char count;
  23          unsigned char count_1;
  24            
  25          void display()
  26            {
  27   1          if(count_1 == 1)
  28   1          {
  29   2          P0 = 0x0e;
  30   2          P1 = num[a];
  31   2          }
  32   1          
  33   1          if(count_1 == 2)
  34   1          {
  35   2          P0 = 0x0d;
  36   2          P1 = num[b];
  37   2          }
  38   1          
  39   1          if(count_1 == 3)
  40   1          {
  41   2          P0 = 0x0b;
  42   2          P1 = num[c];
  43   2          }
  44   1          
  45   1          if(count_1 == 4)
  46   1          {
  47   2          P0 = 0x07;
  48   2          P1 = num[d];
  49   2            
  50   2          count_1 = 0;
  51   2          }
  52   1          
C51 COMPILER V9.60.0.0   MAIN                                                              03/20/2020 22:21:02 PAGE 2   

  53   1          return;
  54   1        }   
  55            
  56          void main()
  57          {
  58   1        
  59   1        TMOD = 0x01; //GATE = 0, C/T = 0, Timer/counter mode 1, Use timer/counter 0 & 1.
  60   1        TF0 = 0; // Timer/counter 0 interrupt flag clear
  61   1      
  62   1        
  63   1        TL0 = 0xc3 ;
  64   1        TH0 = 0x50 ; // TI0 occurs every 0.05 sec 
  65   1        
  66   1        IE = 0x82; // 0b1000 0010 IE -> interrupt enable reg. Timer interrupt enables & entire interrupt enable.
  67   1         
  68   1        IP = 0x02; // IP -> interrupt priority. Set timer interrupt 0 as the highest priority. 
  69   1                     // Should have to consider which register(btw IE & IP) comes first. 
  70   1                     //This code is unnecessary, since the priority of TI0 is higher than the priority of TI1(by 
             -internal polling). 
  71   1        
  72   1        TR0 = 1; // Timer interrupt 0 RUN.
  73   1        
  74   1        count = 20; // 0.05*20 = 1sec. 
  75   1        count_1 = 0;
  76   1        
  77   1        while(1)
  78   1        {
  79   2          if(T_int_flag_01)
  80   2          {
  81   3            i++;
  82   3            j++;
  83   3            k++;
  84   3            
  85   3            if(i==1000)
  86   3            {
  87   4              a++;
  88   4              
  89   4            if(a>9) a=0;
  90   4                
  91   4              i=0;
  92   4            }
  93   3            
  94   3            if(j==100)
  95   3            {
  96   4              b++;
  97   4              
  98   4            if(b>9) b=0;
  99   4                
 100   4              j=0;
 101   4            }
 102   3            
 103   3            if(k==10)
 104   3            {
 105   4              c++;
 106   4                
 107   4            if(c>9) c=0;
 108   4                
 109   4              k=0;
 110   4            }
 111   3            
 112   3              d++;
 113   3              
C51 COMPILER V9.60.0.0   MAIN                                                              03/20/2020 22:21:02 PAGE 3   

 114   3            if(d>9) d=0;
 115   3          
 116   3            
 117   3            count = 20;
 118   3            T_int_flag_01 = 0;
 119   3          }
 120   2          
 121   2          //else if(T_int_flag_02)
 122   2            count_1++;
 123   2          
 124   2            display();
 125   2          
 126   2        }
 127   1      }
 128          
 129          
 130          void T_int_01() interrupt 1 // void [user name]() interrupt [vector num.]
 131          {
 132   1        count--; // Since the const. count is 50, T_int_flag is set until count decreased to zero. 
 133   1                 
 134   1        if(!count) T_int_flag_01 = 1;
 135   1        
 136   1        TL0 = 0xc3 ;
 137   1        TH0 = 0x50 ; // Reset of these two register is necessary for periodic interrupt since it is mode 1.
 138   1        EA = 1; // Interrupt enables
 139   1        return;
 140   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    230    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
