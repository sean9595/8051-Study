C51 COMPILER V9.60.0.0   MAIN                                                              04/02/2020 15:56:14 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /*
   2          *Project name: PWM
   3          *File name: main.c
   4          *Author: Sean Kim
   5          *Date: 03.31.20
   6          *Edited: 
   7          */
   8          
   9          #include <main.h>
  10          #include <math.h>
  11          #include <at89x52.h>
  12          
  13          /*Pin definition*/
  14          sbit PWM_out = P0^0; // 
  15          
  16          /*Flag definition*/
  17          bit PWM_High_flag = 0;
  18          bit PWM_int_flag_High = 0;
  19          bit PWM_int_flag_Low = 0;
  20          
  21          /*typedef unsigned short = uint16_t;*/
  22          unsigned short period = 20000; //unit: us (valid range: 0~65535)
  23          unsigned char duty = 20; //unit: percentage
  24          unsigned short CCR_01 = 0;
  25          unsigned short CCR_02 = 0;
  26          
  27          void main()
  28          {
  29   1        
  30   1        CCR_01 = (65536 - ((65536 - period)*(duty/100)));
  31   1        CCR_02 = period - CCR_01;
  32   1        
  33   1        TMOD = 0x01; //GATE = 0, C/T = 0, Timer/counter mode 1
  34   1        TF0 = 0; // Timer/counter 0 interrupt flag clear
  35   1        TL0 =  0;
  36   1        TH0 =  0; 
  37   1        IE = 0x82; // IE -> interrupt enable reg. Timer interrupt enables & entire interrupt enable.
  38   1        IP = 0x02; // IP -> interrupt priority. Set timer interrupt 0 as the highest priority. 
  39   1                   // Should have to consider which register(btw IE & IP) comes first. 
  40   1        
  41   1        TR0 = 1; // Timer interrupt 0 RUN.
  42   1        
  43   1        while(PWM_int_flag_High)
  44   1        {
  45   2          PWM_out = 1;
  46   2          PWM_int_flag_High = 0;
  47   2        }
  48   1        
  49   1        while(PWM_int_flag_Low)
  50   1        {
  51   2          PWM_out = 0;
  52   2          PWM_int_flag_Low = 0;
  53   2        }
  54   1      }
C51 COMPILER V9.60.0.0   MAIN                                                              04/02/2020 15:56:14 PAGE 2   

  55          
  56          void PWM_int() interrupt 1 // void [user name]() interrupt [vector num.]
  57          {
  58   1        if(PWM_High_flag == 0)
  59   1        {
  60   2          PWM_int_flag_High = 1;
  61   2          PWM_High_flag = 1;
  62   2          TL0 = ((CCR_01>>8) & 0xff);
  63   2          TH0 = (CCR_01 & 0xff);
  64   2        }
  65   1        
  66   1        else
  67   1        {
  68   2          PWM_int_flag_Low = 1;
  69   2          PWM_High_flag = 0;
  70   2          TL0 = ((CCR_02>>8) & 0xff);
  71   2          TH0 = (CCR_02 & 0xff);
  72   2        }
  73   1          
  74   1        EA = 1; // Interrupt enables
  75   1        return;
  76   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    133    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
